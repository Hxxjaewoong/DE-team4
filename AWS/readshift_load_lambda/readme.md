# ðŸ“Œ README: Redshift ë°ì´í„° ì ìž¬ Lambda

ì´ ë¬¸ì„œëŠ” **S3ì—ì„œ ì—…ë¡œë“œëœ Parquet íŒŒì¼ì„ Redshiftë¡œ ì ìž¬í•˜ëŠ” Lambda í•¨ìˆ˜**ì— ëŒ€í•œ ì„¤ëª…ì„ í¬í•¨í•©ë‹ˆë‹¤.  
LambdaëŠ” **S3 ì´ë²¤íŠ¸ë¥¼ ê°ì§€í•˜ì—¬ ì‹¤í–‰ë˜ë©°, Parquet ë°ì´í„°ë¥¼ Staging í…Œì´ë¸”ì„ ê±°ì³ ëŒ€ìƒ í…Œì´ë¸”ë¡œ ì‚½ìž…**í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

---

## ðŸ›  1. ê°œìš”
ì´ Lambda í•¨ìˆ˜ëŠ” **ë§¤ì¼ 20ì‹œ(KST, í•œêµ­ì‹œê°„)** ì´í›„ ì‹¤í–‰ë˜ë©°,  
**ì–´ì œ ìžì •ë¶€í„° ì˜¤ëŠ˜ ìžì •ê¹Œì§€ì˜ ë°ì´í„°ë¥¼ í•„í„°ë§í•˜ì—¬ Redshiftì— ì ìž¬**í•©ë‹ˆë‹¤.

### ðŸ“Œ ê¸°ëŠ¥ ìš”ì•½
1. **S3 ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°** â†’ Parquet íŒŒì¼ì´ ì—…ë¡œë“œë˜ë©´ Lambda ì‹¤í–‰  
2. **Redshift ì—°ê²°** â†’ Staging í…Œì´ë¸”(`temp_staging_table`)ì— Parquet ë°ì´í„° ì ìž¬  
3. **ì‹œê°„ í•„í„°ë§** â†’ `datetime` ì»¬ëŸ¼ì„ ê¸°ì¤€ìœ¼ë¡œ **ì–´ì œ ìžì •~ì˜¤ëŠ˜ ìžì •**ì˜ ë°ì´í„°ë§Œ ì‚½ìž…  
4. **ëŒ€ìƒ í…Œì´ë¸”(`my_table`)ì— ì¶”ê°€ ì‚½ìž…**  
5. **Staging í…Œì´ë¸” ì´ˆê¸°í™”** (ì˜µì…˜)

---

## ðŸ“‚ 2. í™˜ê²½ ë³€ìˆ˜
Lambda ì‹¤í–‰ì„ ìœ„í•´ **ì•„ëž˜ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.**

| í™˜ê²½ ë³€ìˆ˜ëª…          | ì„¤ëª… |
|---------------------|------|
| `REDSHIFT_DATABASE` | Redshift ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„ |
| `REDSHIFT_USER`     | Redshift ì‚¬ìš©ìž ê³„ì • |
| `REDSHIFT_PASSWORD` | Redshift ë¹„ë°€ë²ˆí˜¸ |
| `REDSHIFT_HOST`     | Redshift í´ëŸ¬ìŠ¤í„° í˜¸ìŠ¤íŠ¸ |
| `REDSHIFT_PORT`     | Redshift í¬íŠ¸ (ê¸°ë³¸ê°’: 5439) |

---

## ðŸš€ 3. ì‹¤í–‰ íë¦„
1. **Lambdaê°€ S3 ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ ** (Parquet íŒŒì¼ ì—…ë¡œë“œ ê°ì§€)  
2. **í˜„ìž¬ ì‹œê°„ì„ í™•ì¸**í•˜ì—¬ **20ì‹œ(KST) ì´ì „ì´ë©´ ì‹¤í–‰ ì¤‘ë‹¨**  
3. **Redshiftì— ì—°ê²°** í›„ `temp_staging_table`ì— Parquet ë°ì´í„° ì ìž¬  
4. **ì–´ì œ 00:00 ~ ì˜¤ëŠ˜ 00:00 ë°ì´í„°ë§Œ í•„í„°ë§í•˜ì—¬ `my_table`ì— ì‚½ìž…**  
5. **(ì˜µì…˜) Staging í…Œì´ë¸” ì •ë¦¬** (`TRUNCATE TABLE temp_staging_table;`)

---

## ðŸ—„ 4. Redshift ì ìž¬ SQL ì˜ˆì‹œ
LambdaëŠ” **Redshiftì— Parquet ë°ì´í„°ë¥¼ ì ìž¬**í•˜ê¸° ìœ„í•´ ë‹¤ìŒ SQLì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

### ðŸ“Œ 1ï¸âƒ£ Staging í…Œì´ë¸”ë¡œ ë°ì´í„° ë¡œë“œ
```sql
COPY temp_staging_table
FROM 's3://hmg5th-4-bucket/merge_data/contents/2025-02-22.parquet'
IAM_ROLE 'arn:aws:iam::your-account-id:role/your-redshift-role'
FORMAT AS PARQUET;
```

### ðŸ“Œ 2ï¸âƒ£ ì–´ì œ~ì˜¤ëŠ˜ ìžì • ë°ì´í„°ë§Œ ëŒ€ìƒ í…Œì´ë¸”ì— ì‚½ìž…
```sql
INSERT INTO my_table
SELECT *
FROM temp_staging_table
WHERE datetime >= '2025-02-21 00:00:00'
  AND datetime < '2025-02-22 00:00:00';
```

## ðŸ›‘ 5. ì˜¤ë¥˜ ì²˜ë¦¬
- Redshift ì ìž¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ ì‹œ **ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì¶œë ¥**í•˜ë©°, Lambda ì‹¤í–‰ì´ ì¢…ë£Œë©ë‹ˆë‹¤.
- **20ì‹œ(KST) ì´ì „ì—ëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠìŒ**

---

## ðŸŽ¯ 6. ì£¼ì˜ì‚¬í•­
- **IAM Role ì„¤ì • í•„ìˆ˜**: `COPY` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ **Redshiftì— S3 ì½ê¸° ê¶Œí•œì´ ìžˆëŠ” IAM Role**ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
- **Staging í…Œì´ë¸” í•„ìš”**: `temp_staging_table`ì´ ë¯¸ë¦¬ ìƒì„±ë˜ì–´ ìžˆì–´ì•¼ í•©ë‹ˆë‹¤.
- **ì‹œê°„ ë³€í™˜ ì£¼ì˜**: LambdaëŠ” **UTC ê¸°ì¤€ìœ¼ë¡œ ì‹¤í–‰ë˜ë¯€ë¡œ, í•œêµ­ì‹œê°„(KST)** ë³€í™˜ì´ í•„ìš”í•©ë‹ˆë‹¤.

---

âœ… **ì´ LambdaëŠ” S3ì—ì„œ ì—…ë¡œë“œëœ Parquet íŒŒì¼ì„ í•„í„°ë§í•˜ì—¬ Redshiftì— ì ìž¬í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.**  
âš¡ `Staging í…Œì´ë¸” â†’ ëŒ€ìƒ í…Œì´ë¸”` êµ¬ì¡°ë¡œ ì ìž¬í•˜ì—¬ **ë°ì´í„° í’ˆì§ˆ ìœ ì§€ ë° ì„±ëŠ¥ ìµœì í™”**ë¥¼ ê³ ë ¤í•˜ì˜€ìŠµë‹ˆë‹¤. ðŸš€
